---
permalink: /backup-nand.html
title: Резервное копирование NAND
author_profile: true
---
{% include toc title="Разделы" %}

**Строго не рекомендуется пропускать этот шаг!** Бекап вам поможет избежать брика и, возможно, даже бана! В теории можно восстановить бекап и получить приставку в исходном состоянии, тогда шанс избежать бана намного выше (при условии, что вы не входили в интернет на кастомной прошивке без дополнительных защит в виде DNS)! В будущем появится Emunand, который будет запускать прошивку не из внутренней памяти приставки (NAND), а из раздела на карте памяти. В таком случае можно будет переключаться между чистой прошивкой, на которой безопасно выходить в интернет, и между прошивкой для пиратства буквально обычной перезагрузкой! Но, опять же, если у вас не будет резервной копии чистой системы, то вы рискуете нивелировать все плюсы Emunand. 
{: .notice--danger}

# Что понадобится

* Свежая версия пейлоада {% include inc/hekate.txt %}
* Работающая microSD с не менее чем 32 Гб свободного места, вставленная в Switch в формате exFAT 
* Свежая версия пейлоада [biskeydump](https://switchtools.sshnuke.net/){:target="_blank"}

# Резервное копирование

## Часть I - Дампим NAND

### Способ I - на приставке через hekate

Этот способ требует наличия карты памяти не менее 32-х Гб. Если у вас нет таковой, но есть карта меньшего размера, бекап будет делаться по частям. После заполнения текущего объема на карте на экране будет выведена информация о том, что вам необходимо перенести папку backup на ПК, затем вернуть карту в консоль и продолжить создание резервной копии. После того, как все части бекапа будут находиться в одной папке на компьютере, их нужно склеить, используя скрипт [joiner_scripts_for_windows_linux_macos.zip](https://github.com/CTCaer/hekate/releases/download/v4.2/joiner_scripts_for_windows_linux_macos.zip){:target="_blank"}. Этот способ рассматриваться подробно не будет. Он занимает **намного** больше времени. 
{: .notice--info}

1. Запустите пейлоад {% include inc/hekate.txt %} с помощью [Fusée Gelée](fusee-gelee){:target="_blank"}

	Для перемещения по меню, hekata используйте клавиши (VOL-) и (VOL+), (POWER) для выбора
	{: .notice--info}
	
1. Перейдите в меню "**Tools**" -> "**Backup**"
1. Выберите "**Backup eMMC BOOT0/1**"
	* Дождитесь окончания резервного копирования 
1. Нажмите любую кнопку для выхода в меню
1. Выберите "**Backup eMMC RAW GPP**"
	* Дождитесь окончания резервного копирования
	* Резервное копирование занимает около полутора часов, в зависимости от скорости карты памяти!
1. Нажмите любую кнопку для выхода в меню
1. Выберите "**Back**", чтобы вернуться в предыдущее меню
1. Выберите "**Reboot (RCM)**", чтобы перезагрузить Switch в режим RCM для запуска следующего пейлоадера
1. Вставьте карту памяти приставки в ПК 
1. Скопируйте папку `backup` из корня карты в надёжное место

Если вы делали резервное копирование NAND на новой приставке, в NAND которой ещё не устанавливали игр, то архивирование резервной копии даст качественный результат
{: .notice--warning}

### Способ II - используя ПК

Этот способ сложнее, чем предыдущий, но не требует наличия большой карты памяти. Скорость создания резервной копии таким способом будет не более 6МБ/с
{: .notice--info}

Вам все равно нужно будет сделать резервную копию разделов BOOT0/1 способом, указанным выше!
{: .notice--warning}

1. Выключите консоль
1. Вставьте карту памяти приставки в ПК
1. Убедитесь, что включили [отображение расширений файлов](file-extensions-windows){:target="_blank"}, если у вас Windows
1. Скопируйте **содержимое** папки `sample` из `.zip`-архива с [memloader](https://switchtools.sshnuke.net/){:target="_blank"} в **корень** вашей карты памяти
1. Верните карту памяти обратно в Switch
1. Скопируйте пейлоад [`memloader.bin`](https://switchtools.sshnuke.net/){:target="_blank"} в папку из которой передаёте их на Switch (или в папку `\bootloader\payloads` для запуска через hekate)
1. Запустите пейлоад [`memloader.bin`](https://switchtools.sshnuke.net/){:target="_blank"} с помощью [Fusée Gelée](fusee-gelee){:target="_blank"}
1. На экране приставки выберите `ums_eMMC.ini` и запустите
	* Для перемещения по меню используйте клавиши (VOL-) и (VOL+), для выбора - (POWER)
	* Обратите внимание, что выбрали именно "ums_**eMMC**.ini"
	* Игнорируйте файлы названия которых начинаются с точки, если таковые будут присутствовать

	**ВНИМАНИЕ!!!** Если вы в процессе выполнения руководства увидите диалоговое окно, с предложением отформатировать диск - **нажмите отмена**!!
	{: .notice--danger}
	
	![]({{ base_path }}/images/screenshots/format.png) 
	{: .text-center}
	{: .notice--danger}
	
	![]({{ base_path }}/images/screenshots/format_mac.png)
	{: .text-center}
	{: .notice--danger}

	* Экран приставки останется чёрным 
	* У вас появится несколько новых дисков
	
**Выберите вашу операционную систему:**

* [Windows](#windows) 
* [macOS](macos)

___

#### Windows

##### Что понадобится

* Свежая версия [TegraRcmGUI](https://github.com/eliboa/TegraRcmGUI/releases/latest){:target="_blank"}
* Свежая версия [HDD Raw Copy Tool](http://hddguru.com/software/HDD-Raw-Copy-Tool/HDDRawCopy1.10Portable.exe){:target="_blank"}

##### Установка драйверов 

Если драйвера уже были установлены, пропустите эту часть

1. Запустите `TegraRcmGUI.exe` от имени Администратора 
1. Перейдите во вкладку `Settings` и нажмите "**Install Driver**"
1. Установите драйвер
1. После успешной установки драйвера закройте программу 

##### Резервное копирование
	
1. Запустите "Диспетчер устройств", убедитесь, что там, в дереве "**Дисковые устройства**" появилось устройство с названием "**LINUX UMS DISK 0**"
	* Если такового там нет, 
		* удалите все устройства с восклицательным знаком (так же ставьте галочку на удалении драйверов)
		* удалите все устройства с меткой "**USB Download Gadget**".
		* После удаления устройств выберите "**Действия**" -> "**Обновить конфигурацию оборудования**" в диспетчере устройств
	* Если после всех манипуляций диск так и не появился, выключите Switch, перезагрузите ПК, переустановите драйвера и по новой запустите пейлоад `memloader.bin` с помощью [Fusée Gelée](fusee-gelee){:target="_blank"}
1. Запустите [HDD Raw Copy Tool](http://hddguru.com/software/HDD-Raw-Copy-Tool/HDDRawCopy1.10Portable.exe){:target="_blank"} от имени администратора
1. Выберите "**LINUX UMS DISK 0**" и нажмите "**Continue**"
1. Два раза кликните на надписи "**Double-click to open file**" и сохраните бекап с именем `rawnand.bin` и нажмите "**Continue**"
1. Нажмите "**START**", чтобы начать резервное копирование
1. Если всё прошло успешно, то дамп NAND появится в директории, которую вы указали. Сохраните его в надёжном месте!

Следующий шаг: [Дампим ключи](#часть-ii---дампим-ключи)
{: .notice--success}

___

#### macOS

1. Запустите программу Дисковая утилита, убедитесь, что там появился внешний диск с названием "Linux UMS disk 0 Media"
	* Если такового нет, то выключите Switch и по новой запустите пейлоад `memloader.bin` с помощью [Fusée Gelée](fusee-gelee){:target="_blank"}
1. В Дисковой утилите нажмите правой кнопкой мыши на пункте "Linux UMS disk 0 Media"
1. Выберите опцию "Образ из Linux UMS disk 0 Media" и укажите путь куда сохранить полученный файл
	* Процесс займёт какое-то время. 
	* Если вы хотите восстановить бэкап на ваше устройство, то выберите опцию "Восстановить...", а в появившемся окне нажмите кнопку "Образ..." и укажите путь до сохранённого файла.
1. Если всё прошло успешно, то дамп NAND появится в директории, которую вы указали. Сохраните его в надёжном месте!

Следующий шаг: [Дампим ключи](#часть-ii---дампим-ключи)
{: .notice--success}

___

## Часть II - Дампим ключи

### Дампим biskeys

1. Запустите пейлоад [biskeydump](https://switchtools.sshnuke.net/){:target="_blank"} с помощью [Fusée Gelée](fusee-gelee){:target="_blank"}. Не забудьте предварительно разархивировать пейлоад!
1. Отсканируйте появившийся на экране приставки QR-код с помощью смартфона (для Android рекомендую [эту](https://play.google.com/store/apps/details?id=com.teacapps.barcodescanner&hl=ru){:target="_blank"} программу) и отправьте на ПК полученные ключи
	* Если вы используйте "TegraRcmSmash", вы можете передать пейлоад через командную строку и получить ключи прямо в ней: `TegraRcmSmash.exe -w -r biskeydump.bin`
1. Сохраните полученные ключи в надёжном месте (например, в текстовом файле `keys_bis.txt` и положите его в папку с остальными бекапами)

# Восстановление резервной 

## Восстановление через hekate 

1. На ПК перейдите в папку со своими резервными копиями 
1. В папке `backup -> ID` создайте папку `restore` и переместите содержимое папку `ID` в папку `restore`
	* ID - код из 8-ми символов от "0" до "9" и от "a" до "f"
	* Если папок нет, например из-за того, что резервную копию делали через ПК, просто сделайте бекап чего-либо не большого (BOOT1, например) в гекате и папки появятся
1. Переместите папку `backup` в корень карты памяти вашей консоли
1. Запустите пейлоад {% include inc/hekate.txt %} с помощью [Fusée Gelée](fusee-gelee){:target="_blank"}

	Для перемещения по меню, hekata используйте клавиши (VOL-) и (VOL+), для выбора - (POWER)
	{: .notice--info}

1. Перейдите в `Tools -> Restore` и выберите "**Restore eMMC RAW GPP (exFAT only)**"
1. Не забудьте удалить с карты памяти папку `backup` после окончания восстановления и проверки работоспособности консоли после восстановления

## Восстановление через ПК

Восстановление проводится ровно через те же самые программы, что и делалась резервная копия, за исключением того, что вы сперва выбираете файл резервной копии, а потом диск, на который она буде восстанавливаться